# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master


stages:
  - stage: Tutti
    jobs:
    - job: Tutti1
      strategy:
        matrix:
          Linux:
            osName: 'Linux'
            imageName: 'ubuntu-18.04'
          Mac:
            osName: 'Mac'
            imageName: 'macos-10.14'
      pool:
        vmImage: $(imageName)
      steps:
      - checkout: self
        submodules: recursive
      - bash: sudo echo "deb http://archive.ubuntu.com/ubuntu/ disco main restricted" >> /etc/apt/sources.list.d/disco.lst && sudo apt-get update && sudo apt install -y cmake make build-essential g++ gcc libgtk-3-dev libgtkmm-3.0-dev
        displayName: Install Dependencies Linux
        condition: eq( variables['Agent.OS'], 'Linux' )
      - bash: brew install gtk+3 gtkmm3 cmake pkg-config
        displayName: Install Dependencies macOS
        condition: eq( variables['Agent.OS'], 'Darwin' )
      - bash: mkdir build && cd build && export PATH=/usr/bin:$PATH && cmake --version && cmake .. && make
        displayName: Build
      - task: PublishPipelineArtifact@1
        inputs:
          targetPath: '$(Build.SourcesDirectory)/build/tasarch'
          artifact: 'TASArch'
          publishLocation: 'pipeline'
      - task: PublishPipelineArtifact@1
        inputs:
          targetPath: '$(Build.SourcesDirectory)/cores/'
          artifact: 'cores'
          publishLocation: 'pipeline'
